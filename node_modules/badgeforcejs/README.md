# badgeforcejs <img align="right" src="./assets/logo.png" height="40px" border="0"/>
[![Documentation](https://img.shields.io/badge/documentation-passing-blue.svg)](https://badgeforce.github.io/badgeforcejs/)


JavaScript API module for interacting with BadgeForce smart contracts. This module attempts to abstract away a lot of manual setup and configuration that needs to be done in order to interact
with smart contracts, making development faster and concise. This module can be used to build dashboards, webapps, tools etc for BadgeForce smart contracts.

## Getting Started
These instructions will get you up and running.

### Install
Install badgeforcejs with either yarn or npm

###### Yarn
```sh
$ yarn add badgeforcejs
```

###### NPM
```sh
$ npm install badgeforcejs
```

### Usage
These are the steps to start interacting with a deployed BadgeForce smart contract. We will use
the BadgeForce Holder smart contract as a reference as we go through the usage of this module.

#### Modules
Each official BadgeForce smart contract has an JavaScript module to interact with it. These are split into two JavaScript classes, a client class and a api class (named export matches contract name). The client classes is configured once and then used to get instances of an api class instantiated with the data of the smart contract a a particular address.

i.e: The BadgeForce Holder smart contract has HolderClient and Holder JavaScript classes associated with it. The HolderClient is configured and then used to get Holder objects at a particular smart contract address

###### Configuration
Before you can start using the client classes you must define a configuration object for them called ContractConfig. The ContractConfig object lets the client objects know the address of your ethereum node, the smart contract JSON ABI to use, signer account for transactions, and the roof amount of gas to be sent with each transaction.

```js
// this is the JSON ABI file exported from the badgeforce project for the Holder smart contract
const holderArtifacts = require("badgeforce").holder;

// the http endpoint of your running ethereum node
const ethereumNodeHost = "http://127.0.0.1:8545";

// index of the account that you want to be set as the transaction signer
const accountIndex = 0;

// roof amount of gas to be sent with transactions
const gas = 7500000;

// create a new ContractConfig object for your HolderClient object
const holderClientConfig = new ContractConfig(ethereumNodeHost, holderArtifacts, accountIndex, gas, netWorkId);

// now get a HolderClient object that will be used to produce instances of the Holder class instantiated with the data of a Holder smart contract deployed at a specific address
const holderClient = new HolderClient(holderClientConfig);
```

###### Client Object
Now that are client object is configured we can use it to interact with a deployed Holder smart contract by using the getInstance method passing the address of the deployed contract  

```js
// this is the address of your deployed Holder smart contract
const contractAddress = "0x90f8bf6a479f320ead074411a4b0e7944ea8c9c1";

// Holder object instantiated with the data of a Holder smart contract deployed at contractAddress
const holder = await holderClient.getInstance(contractAddress);
```

###### API Object Classes (Holder, Issuer, etc)
With our new Holder Object we can call any methods on it we want. These methods invoke the corresponding functions on the smart contract. All instance methods on the API classes return promises

i.e: To get the number of credentials a holder has
```js
const numberOfCredentials = await holder.getNumberOfCredentials();
```

### Running Tests
All the test are ran with Jest and are functional test that use ganache-cli as a test ethereum node.

###### Manual Running
First make sure your ganache-cli instance is running on port 8000 and has a networkId of 3000. The test instance is started with a very low gas price and a very high initial Ether amount for the accounts to make sure test don't run out of gas. The default account at index 0 is used and unlocked
```sh
$ node_modules/ganache-cli/build/cli.node.js -l 450000000 -g .5 -networkid 3000 -p 8000 -e 90000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000 -u 0
```

Now run the test
```sh
$ yarn test
```

###### Automated E2E Running
We use forever and wait-on to run test in a automated fashion. forever starts up our ganache-cli instance and a test server. The test server runs on a different port as the ganache-cli instance and has a check endpoint that will return a 200 OK http status code if the ganache-cli instance is listening for connections, we use the wait-on module to ping the test server and wait for the 200 response indicating the ganache-cli is ready before we run the test task

```sh
$ yarn test:e2e
```

If any of the test fail make sure to stop those forever processes manually

```sh
$ yarn stop:test_servers
```

## License

This project is licensed under the MIT License - see the [LICENSE](LICENSE) file for details
